#! python


def build(ctx):
    # Run reduced form regressions, generates Table 1 in main text.
    ctx(
        features='run_do_script',
        source='reducedform_evidence_surveys.do',
        # These are the files generated by this file.
        target=[ctx.path_to(ctx, 'OUT_ANALYSIS', 'log', 'reducedform_evidence_surveys.log'),
                ctx.path_to(ctx, 'OUT_DATA', 'rf_reg_surveys.dta'),
                ctx.path_to(ctx, 'OUT_TABLES', 'rf_vtest.tex'),
                ctx.path_to(ctx, 'OUT_TABLES', 'rf_switching.tex'),
                ctx.path_to(ctx, 'OUT_TABLES', 'rf_betterchoice.tex'),
                ctx.path_to(ctx, 'OUT_TABLES', 'rf_maintext.tex'),
                ctx.path_to(ctx, 'OUT_TABLES', 'rf_maintext_aej.tex'),
                ],
        # List of files on which this code file depends.
        deps=[ctx.path_to(ctx, 'OUT_DATA', 'survey_controlvars.dta')
              ],
        # Name for process (only crucial for Stata-do-files).
        name='reducedform_evidence_surveys'
    )
    # This file computes descriptive statistics.
    ctx(
        features='run_do_script',
        source='desc_stat_tables.do',
        target=[ctx.path_to(ctx, 'OUT_ANALYSIS', 'log', 'desc_stat_tables.log'),
                ctx.path_to(ctx, 'OUT_FIGURES', 'switching.pdf'),
                ctx.path_to(ctx, 'OUT_DATA', 'prices_data.csv'),
                ctx.path_to(ctx, 'OUT_DATA', 'awareness_switching_data.csv')],
        # List of files on which this code file depends.
        deps=[ctx.path_to(ctx, 'OUT_DATA', 'new_master_data.dta')
              ],
        # Name for process (only crucial for Stata-do-files).
        name='desc_stat_tables'
    )
    # This file runs reduced form regressions on macro data providing evidence for state dependence, only reported in Online Appendix.
    ctx(
        features='run_do_script',
        source='rf_evidence_macrodata.do',
        target=[ctx.path_to(ctx, 'OUT_ANALYSIS', 'log', 'rf_evidence_macrodata.log'),
                ctx.path_to(ctx, 'OUT_TABLES', 'rfmacro.tex'),
                ctx.path_to(ctx, 'OUT_TABLES', 'hausman_IV_evidence_1.tex'),
                ctx.path_to(ctx, 'OUT_TABLES', 'hausman_IV_evidence_2.tex')
                ],
        # List of files on which this code file depends.
        deps=[ctx.path_to(ctx, 'OUT_DATA', 'new_master_data.dta'),
              ctx.path_to(ctx, 'OUT_DATA', 'wholesaleGasPrices.dta')
              ],
        # Name for process (only crucial for Stata-do-files).
        name='rf_evidence_macrodata'
    )
    # This file generates reduced form evidence for some of our assumptions in the structural model.
    # Results are only provided in the online appendix.
    ctx(
        features='run_do_script',
        source='rf_evidence_adv_assumptions.do',
        target=[ctx.path_to(ctx, 'OUT_ANALYSIS', 'log', 'rf_evidence_adv_assumptions.log'),
                ctx.path_to(ctx, 'OUT_FIGURES',
                            'ada_evidence_vtestadspending.pdf'),
                ctx.path_to(ctx, 'OUT_FIGURES',
                            'ada_evidence_vtestinternet.pdf'),
                ctx.path_to(ctx, 'OUT_FIGURES',
                            'ada_evidence_adspendinginternet.pdf'),
                ctx.path_to(ctx, 'OUT_ANALYSIS', 'ada_evidence_data.csv'),
                ctx.path_to(ctx, 'OUT_TABLES', 'rf_ada_evidence.tex'),
                ],
        # List of files on which this code file depends.
        deps=[ctx.path_to(ctx, 'OUT_DATA', 'new_master_data.dta'),
              ctx.path_to(ctx, 'OUT_DATA', 'avg_price_data.dta'),
              ctx.path_to(ctx, 'OUT_DATA', 'avg_adv_data.dta'),
              ctx.path_to(ctx, 'OUT_DATA', 'internet_adv.dta'),
              ],
        # Name for process (only crucial for Stata-do-files).
        name='rf_evidence_adv_assumptions'
    )

    # This file runs the main structural estimation and will run for several days.
    ctx(
        features='run_m_script',
        source='estimate_model.m',
        deps=[
            ctx.path_to(ctx, 'OUT_DATA', 'new_master_data.csv'),
            ctx.path_to(ctx, 'OUT_DATA', 'demo_data.csv'),
            ctx.path_to(ctx, 'OUT_DATA', 'advertisingdata.csv'),
            ctx.path_to(ctx, 'OUT_DATA', 'initialconditions.csv'),
            ctx.path_to(ctx, 'OUT_DATA', 'ws_future_int_lags.csv'),
            ctx.path_to(ctx, 'OUT_DATA', 'internet_adv.csv'),
            ctx.path_to(ctx, 'OUT_DATA', 'micromoments.csv'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'model_myopic.m'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'contrMap_ES.c'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'contrMap_ES_alt_LS.c'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'ars.m'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'calc_se.m'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'calc_efficient_w.m')
            ],
    target=[
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod6.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod6.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod6.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod6.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod6.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod8.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod8.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod6.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod6.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_2_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_2_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_2_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_2_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_2_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_2_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_2_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_2_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_2_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_2_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_2_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_2_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_2_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_2_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_2_mod7.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_2_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_2_mod8.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_2_mod7.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_2_mod8.csv')
        ]
    )


    # This file is a potential workaround if you prefer to run estimate_model.m manually and in several steps. This file is needed to generate a complete DAG for waf to build the project.
    # ctx(
    #     features='run_m_script',
    #     source='load_postestimation_workspaces.m',
    #     target=[
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod5.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod6.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_1_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod5.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod6.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_1_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_active_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'mm_pred_swhet_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_1_nl_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod5.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod6.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_1_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod5.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod6.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_1_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod5.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod6.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_1_mod8.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_1_mod8.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod5.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod6.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_opt_2_nl_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod5.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod6.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'theta_lin_opt_2_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod5.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod6.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'expmvalold_opt_2_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_2_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_2_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'kappa_EUR_2_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_2_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_2_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'wtp_comp_2_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_2_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_2_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_raw_data_2_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_2_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_2_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'contract_values_2_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_2_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_2_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_pcw_2_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_2_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_2_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'gf_churn_2_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_2_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_2_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_contract_2_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_2_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_2_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'ccp_firm_2_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_2_mod1.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_2_mod4.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_2_mod7.mat'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_2_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_2_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_2_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultsraw_2_mod8.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_2_mod1.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_2_mod4.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_2_mod7.csv'),
    #         ctx.path_to(ctx, 'OUT_ANALYSIS', 'estresultslegend_2_mod8.csv')
    #     ]
    # )

    # This file runs the counterfactuals.
    ctx(
        features='run_m_script',
        source='counterfactuals.m',
        deps=[
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_1_mod6.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_2_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'postestimation_workspace_2_mod4.mat'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'model_myopic.m'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'contrMap_ES.c'),
            ctx.path_to(ctx, 'IN_ANALYSIS', 'compute_cf_shares.m'),
            ctx.path_to(ctx, 'OUT_DATA', 'wholesale_corr_export.csv')
            ],
        target=[
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ms_firm_obs.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'ms_firm_pred.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_only1_price_id_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_only1_price_id_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_only1_price_id_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_only1_price_id_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_only_2_price_id_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_only_2_price_id_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_only_2_price_id_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_only_2_price_id_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_2_nosc_price_id_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_2_nosc_price_id_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_2_nosc_price_id_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_2_nosc_price_id_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_2_lc_nosc_price_id_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_2_lc_nosc_price_id_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_2_lc_nosc_price_id_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_2_lc_nosc_price_id_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_all_price_id_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_all_price_id_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_all_price_id_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_inc_all_price_id_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'welfare_comp_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'welfare_comp_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'welfare_comp_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'welfare_comp_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_marketshares_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_marketshares_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_marketshares_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_marketshares_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_pcw_use_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_pcw_use_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_pcw_use_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_pcw_use_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_pcw_change_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_pcw_change_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_pcw_change_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_pcw_change_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'id_mu_2_mod1.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'id_mu_2_mod4.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'id_mu_1_mod5.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'id_mu_1_mod6.csv'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_workspace_2_mod1.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_workspace_2_mod4.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_workspace_1_mod5.mat'),
            ctx.path_to(ctx, 'OUT_ANALYSIS', 'cf_workspace_1_mod6.mat')
        ]
       )
